@using WinWin.Core.Tools.PublicTools
@using Microsoft.AspNetCore.Mvc.TagHelpers
@using System.Security.Claims
@model List<WinWin.DataLayer.DTOS.ChatHub.ChatMessageViewModel>

@{
    ViewBag.Title = "اتاق گفت‌وگو";
    var roomId = ViewBag.RoomId;
    var userId = ViewBag.UserId;
}
<link href="~/css/chathub/chathub.css" rel="stylesheet" />
<input type="hidden" id="roomId" value="@roomId" />
<input type="hidden" id="userId" value="@userId" />

<div class="container-fluid">
    <h2 class="mb-4 text-center">💬 گفت‌وگو</h2>
    <div class="row">
        <!-- بخش rooms به سمت راست -->
        <div id="rooms" class="col-4 col-md-4 d-flex flex-column align-items-end p-3">
            @await Component.InvokeAsync("Chats", new { userId = Guid.Parse(userId),roomId = roomId })
        </div>

     
        <div class="col-8 col-md-8">


            <div class="card mb-3">
                <div class="card-body" id="messagesContainer" style="height: 400px; overflow-y: auto; padding-bottom: 10px;">
                    @if (Model.Count > 0)
                    {
                        foreach (var message in Model)
                        {
                            <div class="chat-message-container mb-2" style="animation: fadeIn 0.5s ease-in;">
                                <div class="chat-message @((message.IsMine) ? "my-message" : "other-message")">
                                    <div class="chat-message-header">
                                        <strong>
                                            @if (message.FromUserName != null)
                                            {
                                                @message.FromUserName
                                            }
                                            else
                                            {
                                                <em>کاربر ناشناس</em>
                                            }
                                        </strong>
                                        <hr/>
                                        <small style="font-size: 8px;" class="text-muted">@message.Timestamp</small>
                                    </div>
                                    <div class="chat-message-body">
                                        @message.Content
                                    </div>
                                </div>
                            </div>
                        }
                    }
                    else
                    {
                        <div class="text-muted text-center">📭 هنوز پیامی ارسال نشده.</div>
                    }
                </div>
            </div>

            <form id="sendMessageForm" class="input-group mt-3">
                <textarea id="messageContent" class="form-control" placeholder="متن پیام خود را بنویسید..." rows="1"></textarea>
                <button type="submit" class="btn btn-primary">ارسال</button>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/7.0.5/signalr.min.js"></script>
    <script src="~/js/chat.js"></script>

}
