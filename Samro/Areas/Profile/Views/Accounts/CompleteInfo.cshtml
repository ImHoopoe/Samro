@model WinWin.DataLayer.DTOS.CompleteInfoViewModel
@{
    Layout = "~/Views/Shared/UserProfile/UserProfileLayout.cshtml";
}

<h2 class="mb-4">تکمیل اطلاعات کاربر</h2>

@if (TempData["Error"] != null)
{
    <div class="alert alert-danger">@TempData["Error"]</div>
}
@if (TempData["Success"] != null)
{
    <div class="alert alert-success">@TempData["Success"]</div>
}

<form asp-action="CompleteInfo" method="post" enctype="multipart/form-data" class="needs-validation" novalidate>
    <div class="row g-3">
        <div class="col-md-6">
            <label asp-for="UserName" class="form-label"></label>
            <input asp-for="UserName" class="form-control" />
            <span asp-validation-for="UserName" class="text-danger"></span>
        </div>
        <div class="col-md-6">
            <label asp-for="Email" class="form-label"></label>
            <input asp-for="Email" class="form-control" readonly />
            <span asp-validation-for="Email" class="text-danger"></span>
        </div>

        <div class="col-md-6">
            <label asp-for="Name" class="form-label"></label>
            <input asp-for="Name" class="form-control" />
            <span asp-validation-for="Name" class="text-danger"></span>
        </div>
        <div class="col-md-6">
            <label asp-for="LastName" class="form-label"></label>
            <input asp-for="LastName" class="form-control" />
            <span asp-validation-for="LastName" class="text-danger"></span>
        </div>

        <div class="col-md-6">
            <label asp-for="PhoneNumber" class="form-label"></label>
            <input asp-for="PhoneNumber" class="form-control" />
            <span asp-validation-for="PhoneNumber" class="text-danger"></span>
        </div>
        <div class="col-md-6">
            <label asp-for="NationalId" class="form-label"></label>
            <input asp-for="NationalId" class="form-control" />
            <span asp-validation-for="NationalId" class="text-danger"></span>
        </div>

        <div class="col-12">
            <label asp-for="Address" class="form-label"></label>
            <input asp-for="Address" class="form-control" />
            <span asp-validation-for="Address" class="text-danger"></span>
        </div>

        <div class="col-md-4">
            <label asp-for="Age" class="form-label"></label>
            <input asp-for="Age" type="number" min="0" max="120" class="form-control" />
            <span asp-validation-for="Age" class="text-danger"></span>
        </div>
        <div class="col-md-4">
            <label asp-for="Height" class="form-label"></label>
            <input asp-for="Height" type="number" min="0" max="3" step="0.01" class="form-control" />
            <span asp-validation-for="Height" class="text-danger"></span>
        </div>
        <div class="col-md-4">
            <label asp-for="Weight" class="form-label"></label>
            <input asp-for="Weight" type="number" min="0" max="500" step="0.1" class="form-control" />
            <span asp-validation-for="Weight" class="text-danger"></span>
        </div>

        <div class="col-md-6">
            <label class="form-label">جنسیت</label>
            <div class="form-check">
                <input class="form-check-input" type="radio" asp-for="IsMan" value="true" id="male" checked="@Model.IsMan">
                <label class="form-check-label" for="male">مرد</label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="radio" asp-for="IsMan" value="false" id="female" checked="@(Model.IsMan == false)">
                <label class="form-check-label" for="female">زن</label>
            </div>
            <span asp-validation-for="IsMan" class="text-danger"></span>
        </div>


        <div class="col-md-6">
            <label class="form-label">تصویر آواتار</label>
            <div class="card text-center p-3">
                <img id="avatarPreview" src="@(Model.Avatar ?? "/images/default-avatar.png")" class="rounded-circle mb-3" style="width:150px; height:150px; object-fit:cover; border:2px solid #0d6efd;" alt="پیش‌نمایش آواتار" />

                <div class="mb-2">
                    <input asp-for="Avatar" type="file" accept="image/*" class="form-control" onchange="previewAvatar(event)" />
                </div>

                <button type="button" class="btn btn-outline-danger btn-sm" onclick="removeAvatar()">حذف تصویر</button>
            </div>
            <span asp-validation-for="Avatar" class="text-danger"></span>
        </div>




        <div class="col-12 form-check mt-3">
            <input asp-for="IsActivated" class="form-check-input" />
            <label asp-for="IsActivated" class="form-check-label"></label>
            <span asp-validation-for="IsActivated" class="text-danger"></span>
        </div>
    </div>

    <button type="submit" class="btn btn-primary mt-4">ذخیره</button>
</form>

@section Scripts {
    <script>
        function previewAvatar(event) {
            const reader = new FileReader();
            reader.onload = function(){
                const output = document.getElementById('avatarPreview');
                output.src = reader.result;
            };
            reader.readAsDataURL(event.target.files[0]);
        }

        function removeAvatar() {
            const output = document.getElementById('avatarPreview');
            const fileInput = document.querySelector('input[asp-for="Avatar"]');
            output.src = "/images/default-avatar.png"; // مسیر تصویر پیش‌فرض
            fileInput.value = ""; // پاک کردن فایل انتخاب شده
        }
    </script>
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
}
